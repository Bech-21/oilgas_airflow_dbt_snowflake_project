[2025-10-12T23:44:32.364+0000] {logging_mixin.py:151} INFO - Changing /opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline permission to 509
[2025-10-12T23:44:32.365+0000] {logging_mixin.py:151} INFO - Failed to change /opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline permission to 509: [Errno 1] Operation not permitted: '/opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline'
[2025-10-12T23:44:32.416+0000] {logging_mixin.py:151} INFO - Changing /opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline permission to 509
[2025-10-12T23:44:32.417+0000] {logging_mixin.py:151} INFO - Failed to change /opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline permission to 509: [Errno 1] Operation not permitted: '/opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline'
[2025-10-12T23:44:32.471+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: ETL_pipeline.bronze_rig_count_pipeline manual__2025-10-12T23:44:30.092215+00:00 [queued]>
[2025-10-12T23:44:32.478+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: ETL_pipeline.bronze_rig_count_pipeline manual__2025-10-12T23:44:30.092215+00:00 [queued]>
[2025-10-12T23:44:32.479+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 3
[2025-10-12T23:44:32.489+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): bronze_rig_count_pipeline> on 2025-10-12 23:44:30.092215+00:00
[2025-10-12T23:44:32.497+0000] {standard_task_runner.py:57} INFO - Started process 11861 to run task
[2025-10-12T23:44:32.505+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'ETL_pipeline', 'bronze_rig_count_pipeline', 'manual__2025-10-12T23:44:30.092215+00:00', '--job-id', '27', '--raw', '--subdir', 'DAGS_FOLDER/ETL_pipeline.py', '--cfg-path', '/tmp/tmpgwqvkj6_']
[2025-10-12T23:44:32.512+0000] {standard_task_runner.py:85} INFO - Job 27: Subtask bronze_rig_count_pipeline
[2025-10-12T23:44:32.559+0000] {logging_mixin.py:151} INFO - Changing /opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline permission to 509
[2025-10-12T23:44:32.560+0000] {logging_mixin.py:151} INFO - Failed to change /opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline permission to 509: [Errno 1] Operation not permitted: '/opt/***/logs/dag_id=ETL_pipeline/run_id=manual__2025-10-12T23:44:30.092215+00:00/task_id=bronze_rig_count_pipeline'
[2025-10-12T23:44:32.562+0000] {task_command.py:415} INFO - Running <TaskInstance: ETL_pipeline.bronze_rig_count_pipeline manual__2025-10-12T23:44:30.092215+00:00 [running]> on host f22a895b55de
[2025-10-12T23:44:32.637+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='bech' AIRFLOW_CTX_DAG_ID='ETL_pipeline' AIRFLOW_CTX_TASK_ID='bronze_rig_count_pipeline' AIRFLOW_CTX_EXECUTION_DATE='2025-10-12T23:44:30.092215+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-10-12T23:44:30.092215+00:00'
[2025-10-12T23:44:32.639+0000] {bronze_layer.py:123} INFO - Starting bronze layer data ingestion...
[2025-10-12T23:44:32.639+0000] {logging_mixin.py:151} INFO - Getting rig count data...
[2025-10-12T23:44:34.859+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/openpyxl/worksheet/_reader.py:329 UserWarning: Unknown extension is not supported and will be removed
[2025-10-12T23:44:34.887+0000] {logging_mixin.py:151} INFO - Successfully loaded Excel file. Shape: (16503, 12)
[2025-10-12T23:44:34.902+0000] {base.py:73} INFO - Using connection ID 'oil_gas_conn' for task execution.
[2025-10-12T23:44:34.903+0000] {connection.py:314} INFO - Snowflake Connector for Python Version: 3.1.1, Python Version: 3.8.18, Platform: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.2.5
[2025-10-12T23:44:34.904+0000] {connection.py:1050} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-10-12T23:44:34.904+0000] {connection.py:1068} INFO - Setting use_openssl_only mode to False
[2025-10-12T23:44:35.304+0000] {cursor.py:804} INFO - query: [ALTER SESSION SET autocommit=False]
[2025-10-12T23:44:35.430+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:35.431+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:35.434+0000] {sql.py:418} INFO - Running statement: USE WAREHOUSE COMPUTE_WH, parameters: None
[2025-10-12T23:44:35.435+0000] {cursor.py:804} INFO - query: [USE WAREHOUSE COMPUTE_WH]
[2025-10-12T23:44:35.509+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:35.510+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:35.511+0000] {sql.py:427} INFO - Rows affected: 1
[2025-10-12T23:44:35.512+0000] {snowflake.py:427} INFO - Rows affected: 1
[2025-10-12T23:44:35.512+0000] {snowflake.py:428} INFO - Snowflake query id: 01bfabb0-0106-a44d-000b-be530029a0fe
[2025-10-12T23:44:35.512+0000] {cursor.py:804} INFO - query: [COMMIT]
[2025-10-12T23:44:35.921+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:35.921+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:35.922+0000] {connection.py:640} INFO - closed
[2025-10-12T23:44:35.968+0000] {connection.py:646} INFO - No async queries seem to be running, deleting session
[2025-10-12T23:44:36.027+0000] {base.py:73} INFO - Using connection ID 'oil_gas_conn' for task execution.
[2025-10-12T23:44:36.028+0000] {connection.py:314} INFO - Snowflake Connector for Python Version: 3.1.1, Python Version: 3.8.18, Platform: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.2.5
[2025-10-12T23:44:36.029+0000] {connection.py:1050} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-10-12T23:44:36.487+0000] {cursor.py:804} INFO - query: [ALTER SESSION SET autocommit=False]
[2025-10-12T23:44:36.564+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:36.565+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:36.566+0000] {sql.py:418} INFO - Running statement: USE DATABASE OILGAS_DB, parameters: None
[2025-10-12T23:44:36.566+0000] {cursor.py:804} INFO - query: [USE DATABASE OILGAS_DB]
[2025-10-12T23:44:36.657+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:36.658+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:36.658+0000] {sql.py:427} INFO - Rows affected: 1
[2025-10-12T23:44:36.658+0000] {snowflake.py:427} INFO - Rows affected: 1
[2025-10-12T23:44:36.659+0000] {snowflake.py:428} INFO - Snowflake query id: 01bfabb0-0106-9b14-000b-be530028d376
[2025-10-12T23:44:36.659+0000] {cursor.py:804} INFO - query: [COMMIT]
[2025-10-12T23:44:36.759+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:36.760+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:36.760+0000] {connection.py:640} INFO - closed
[2025-10-12T23:44:36.798+0000] {connection.py:646} INFO - No async queries seem to be running, deleting session
[2025-10-12T23:44:36.868+0000] {base.py:73} INFO - Using connection ID 'oil_gas_conn' for task execution.
[2025-10-12T23:44:36.869+0000] {connection.py:314} INFO - Snowflake Connector for Python Version: 3.1.1, Python Version: 3.8.18, Platform: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.2.5
[2025-10-12T23:44:36.870+0000] {connection.py:1050} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-10-12T23:44:37.308+0000] {cursor.py:804} INFO - query: [ALTER SESSION SET autocommit=False]
[2025-10-12T23:44:37.381+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:37.382+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:37.382+0000] {sql.py:418} INFO - Running statement: USE SCHEMA raw, parameters: None
[2025-10-12T23:44:37.383+0000] {cursor.py:804} INFO - query: [USE SCHEMA raw]
[2025-10-12T23:44:37.476+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:37.477+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:37.478+0000] {sql.py:427} INFO - Rows affected: 1
[2025-10-12T23:44:37.478+0000] {snowflake.py:427} INFO - Rows affected: 1
[2025-10-12T23:44:37.478+0000] {snowflake.py:428} INFO - Snowflake query id: 01bfabb0-0106-a4e0-000b-be530029b106
[2025-10-12T23:44:37.478+0000] {cursor.py:804} INFO - query: [COMMIT]
[2025-10-12T23:44:37.647+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:37.648+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:37.649+0000] {connection.py:640} INFO - closed
[2025-10-12T23:44:37.691+0000] {connection.py:646} INFO - No async queries seem to be running, deleting session
[2025-10-12T23:44:37.768+0000] {bronze_layer.py:84} INFO - Storing data in bronze layer...
[2025-10-12T23:44:37.776+0000] {base.py:73} INFO - Using connection ID 'oil_gas_conn' for task execution.
[2025-10-12T23:44:37.777+0000] {connection.py:314} INFO - Snowflake Connector for Python Version: 3.1.1, Python Version: 3.8.18, Platform: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.2.5
[2025-10-12T23:44:37.778+0000] {connection.py:1050} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-10-12T23:44:38.234+0000] {cursor.py:804} INFO - query: [ALTER SESSION SET autocommit=False]
[2025-10-12T23:44:38.335+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:38.336+0000] {cursor.py:959} INFO - Number of results in first chunk: 1
[2025-10-12T23:44:38.337+0000] {sql.py:418} INFO - Running statement: truncate table if exists BRONZE.{BRONZE_TABLE};, parameters: None
[2025-10-12T23:44:38.337+0000] {cursor.py:804} INFO - query: [truncate table if exists BRONZE.{BRONZE_TABLE};]
[2025-10-12T23:44:38.404+0000] {cursor.py:817} INFO - query execution done
[2025-10-12T23:44:38.416+0000] {connection.py:640} INFO - closed
[2025-10-12T23:44:38.460+0000] {connection.py:646} INFO - No async queries seem to be running, deleting session
[2025-10-12T23:44:38.531+0000] {bronze_layer.py:148} ERROR - Bronze layer ingestion failed: 001003 (42000): 01bfabb0-0106-a4e0-000b-be530029b10a: SQL compilation error:
syntax error line 1 at position 32 unexpected '{'.
[2025-10-12T23:44:38.532+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/pipeline/bronze_layer.py", line 137, in bronze_etl
    store_rig_data_snowflake(raw_data, sf_hook)
  File "/opt/airflow/pipeline/bronze_layer.py", line 87, in store_rig_data_snowflake
    sf_hook.run("""
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/snowflake/hooks/snowflake.py", line 415, in run
    self._run_command(cur, sql_statement, parameters)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/common/sql/hooks/sql.py", line 423, in _run_command
    cur.execute(sql_statement)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/cursor.py", line 908, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 290, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 345, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 221, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): 01bfabb0-0106-a4e0-000b-be530029b10a: SQL compilation error:
syntax error line 1 at position 32 unexpected '{'.
[2025-10-12T23:44:38.542+0000] {taskinstance.py:1398} INFO - Marking task as UP_FOR_RETRY. dag_id=ETL_pipeline, task_id=bronze_rig_count_pipeline, execution_date=20251012T234430, start_date=20251012T234432, end_date=20251012T234438
[2025-10-12T23:44:38.555+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 27 for task bronze_rig_count_pipeline (001003 (42000): 01bfabb0-0106-a4e0-000b-be530029b10a: SQL compilation error:
syntax error line 1 at position 32 unexpected '{'.; 11861)
[2025-10-12T23:44:38.614+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2025-10-12T23:44:38.627+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
